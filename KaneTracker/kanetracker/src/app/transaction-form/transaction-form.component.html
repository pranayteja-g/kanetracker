<div class="form-container">
  <h1>Log Transaction</h1>

  <form [formGroup]="transactionForm" (ngSubmit)="onSubmit()" class="transaction-form">

    <!-- Amount with enhanced validation -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Amount (₹)</mat-label>
      <input matInput type="number" formControlName="amount" placeholder="0.00" min="0.01" max="10000000" step="0.01">
      <mat-hint>Maximum amount: ₹1,00,00,000</mat-hint>
      <mat-error *ngIf="transactionForm.get('amount')?.hasError('required')">
        Amount is required
      </mat-error>
      <mat-error *ngIf="transactionForm.get('amount')?.hasError('min')">
        Amount must be greater than 0
      </mat-error>
      <mat-error *ngIf="transactionForm.get('amount')?.hasError('max')">
        Amount cannot exceed ₹1,00,00,000
      </mat-error>
      <mat-error *ngIf="transactionForm.get('amount')?.hasError('unreasonableAmount')">
        This amount seems very large. Please double-check.
      </mat-error>
    </mat-form-field>

    <!-- Type Toggle -->
    <mat-button-toggle-group formControlName="type" class="full-width">
      <mat-button-toggle value="income">Income</mat-button-toggle>
      <mat-button-toggle value="expense">Expense</mat-button-toggle>
    </mat-button-toggle-group>

    <!-- Category with loading state -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Category</mat-label>
      <mat-select formControlName="category" [disabled]="isLoading">
        <mat-option *ngFor="let cat of categories" [value]="cat.name">
          <span class="color-dot" [style.background]="cat.color"></span> {{ cat.name }}
        </mat-option>
        <mat-divider *ngIf="categories.length > 0"></mat-divider>
        <mat-option (click)="addCategory()" class="add-option">
          <mat-icon>add</mat-icon> Add New Category
        </mat-option>
      </mat-select>
      <mat-error *ngIf="transactionForm.get('category')?.hasError('required')">
        Please select a category
      </mat-error>
      <mat-hint *ngIf="categories.length === 0" class="empty-hint">
        No categories available. Create one first!
      </mat-hint>
    </mat-form-field>

    <!-- Date with validation -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Date</mat-label>
      <input matInput [matDatepicker]="picker" formControlName="date">
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
      <mat-hint>Dates more than 7 days in the future are not allowed</mat-hint>
      <mat-error *ngIf="transactionForm.get('date')?.hasError('required')">
        Date is required
      </mat-error>
      <mat-error *ngIf="transactionForm.get('date')?.hasError('futureDate')">
        Date cannot be more than 7 days in the future
      </mat-error>
    </mat-form-field>

    <!-- Description with character count -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Description (Optional)</mat-label>
      <textarea matInput formControlName="description" maxlength="200" rows="3"
        placeholder="Add a note about this transaction..."></textarea>
      <mat-hint align="end">{{transactionForm.get('description')?.value?.length || 0}}/200</mat-hint>
      <mat-error *ngIf="transactionForm.get('description')?.hasError('maxlength')">
        Description is too long (maximum 200 characters)
      </mat-error>
      <mat-error *ngIf="transactionForm.get('description')?.hasError('whitespace')">
        Description cannot be just spaces
      </mat-error>
    </mat-form-field>

    <!-- Submit button with loading state -->
    <button mat-raised-button color="primary" class="full-width submit-btn" type="submit" [disabled]="!canSubmit">
      <mat-icon *ngIf="isSubmitting" class="spinning">refresh</mat-icon>
      <span *ngIf="!isSubmitting">Save Transaction</span>
      <span *ngIf="isSubmitting">Saving...</span>
    </button>

    <!-- Form status indicator -->
    <div *ngIf="transactionForm.invalid && transactionForm.touched" class="form-status error">
      <mat-icon>error</mat-icon>
      Please fix the errors above before submitting.
    </div>
  </form>
</div>